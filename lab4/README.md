## –õ–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–∞—è —Ä–∞–±–æ—Ç–∞ ‚Ññ4
|              **–°—Ç—É–¥–µ–Ω—Ç** | **–ì—Ä—É–ø–ø–∞**   | **–í–∞—Ä–∏–∞–Ω—Ç**  |
|--------------------------|--------------|--------------|
| –ì—É–¥—ã–Ω–∏–Ω –î–∞–Ω–∏–ª–∞ –î–µ–Ω–∏—Å–æ–≤–∏—á | –ú8–û-109–°–í-24 | 12           |

## –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞

–°–∏—Å—Ç–µ–º–∞ –±—é–¥–∂–µ—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å –≥–∏–±—Ä–∏–¥–Ω—ã–º —Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –¥–∞–Ω–Ω—ã—Ö, —Å–æ—Å—Ç–æ—è—â–∞—è –∏–∑ –¥–≤—É—Ö –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–æ–≤:
- **API Gateway** - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–µ–π –∏ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–µ–π –∑–∞–ø—Ä–æ—Å–æ–≤
- **Planning Service** - –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ —Å —Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –≤ PostgreSQL (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏, –ø–ª–∞–Ω—ã) –∏ MongoDB (—Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏)

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Client/User   ‚îÇ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ   API Gateway    ‚îÇ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ Planning Service ‚îÇ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ   PostgreSQL     ‚îÇ
‚îÇ                 ‚îÇ    ‚îÇ  (Port: 8000)    ‚îÇ    ‚îÇ  (Port: 8080)    ‚îÇ    ‚îÇ  (Port: 5432)    ‚îÇ
‚îÇ                 ‚îÇ    ‚îÇ                  ‚îÇ    ‚îÇ                  ‚îÇ    ‚îÇ                  ‚îÇ
‚îÇ ‚Ä¢ Authentication‚îÇ    ‚îÇ ‚Ä¢ JWT Auth       ‚îÇ    ‚îÇ ‚Ä¢ Business Logic ‚îÇ    ‚îÇ ‚Ä¢ Users & Plans  ‚îÇ
‚îÇ ‚Ä¢ API Requests  ‚îÇ    ‚îÇ ‚Ä¢ Request Proxy  ‚îÇ    ‚îÇ ‚Ä¢ CRUD Operations‚îÇ    ‚îÇ ‚Ä¢ Persistent     ‚îÇ
‚îÇ                 ‚îÇ    ‚îÇ ‚Ä¢ Token Validate ‚îÇ    ‚îÇ ‚Ä¢ SQLAlchemy ORM ‚îÇ    ‚îÇ   Data Storage   ‚îÇ
‚îÇ                 ‚îÇ    ‚îÇ                  ‚îÇ    ‚îÇ ‚Ä¢ Data Validation‚îÇ    ‚îÇ ‚Ä¢ Indexed Tables ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                                         ‚îÇ
                                                         ‚ñº
                                                ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                                                ‚îÇ     MongoDB      ‚îÇ
                                                ‚îÇ  (Port: 27017)   ‚îÇ
                                                ‚îÇ                  ‚îÇ
                                                ‚îÇ ‚Ä¢ Transactions   ‚îÇ
                                                ‚îÇ ‚Ä¢ NoSQL Storage  ‚îÇ
                                                ‚îÇ ‚Ä¢ PyMongo Driver ‚îÇ
                                                ‚îÇ ‚Ä¢ Indexed Fields ‚îÇ
                                                ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ —Å–∏—Å—Ç–µ–º–µ

### –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
- [x] HTTP REST API –¥–ª—è –¥–≤—É—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
- [x] JWT —Ç–æ–∫–µ–Ω –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è (Bearer)
- [x] –û—Ç–¥–µ–ª—å–Ω—ã–π endpoint –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–∞
- [x] GET/POST/PUT/DELETE –º–µ—Ç–æ–¥—ã
- [x] **–î–æ–ª–≥–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –≤ PostgreSQL 14** (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏, –ø–ª–∞–Ω—ã)
- [x] **–î–æ–ª–≥–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –≤ MongoDB 4.0** (—Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏)
- [x] **–°–∫—Ä–∏–ø—Ç—ã —Å–æ–∑–¥–∞–Ω–∏—è –ë–î –∏ –Ω–∞–ø–æ–ª–Ω–µ–Ω–∏—è —Ç–µ—Å—Ç–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏**
- [x] **CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏ –¥–ª—è –≤—Å–µ—Ö —Å—É—â–Ω–æ—Å—Ç–µ–π –≤ –æ–±–µ–∏—Ö –ë–î**
- [x] **–•–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–æ–ª–µ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π**
- [x] **–ò–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–ª–µ–π –¥–ª—è –ø–æ–∏—Å–∫–∞ –≤ PostgreSQL –∏ MongoDB**
- [x] –ú–∞—Å—Ç–µ—Ä-–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å (admin/secret)
- [x] OpenAPI —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è
- [x] Docker Compose –∑–∞–ø—É—Å–∫

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫
- **Backend**: Python 3.11, FastAPI
- **ORM**: SQLAlchemy (PostgreSQL), PyMongo (MongoDB)
- **Databases**: PostgreSQL 14, MongoDB 4.0
- **Validation**: Pydantic
- **Authentication**: JWT Bearer tokens, bcrypt –¥–ª—è —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è
- **Containerization**: Docker, Docker Compose
- **Testing**: pytest, curl
- **Documentation**: OpenAPI/Swagger

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑ –¥–∞–Ω–Ω—ã—Ö

### PostgreSQL (–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –∏ –ø–ª–∞–Ω—ã)
- **users** - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å–∏—Å—Ç–µ–º—ã (–ª–æ–≥–∏–Ω, —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–∞—Ä–æ–ª—å)
- **budget_plans** - –ø–ª–∞–Ω—ã –±—é–¥–∂–µ—Ç–∞ (–Ω–∞–∑–≤–∞–Ω–∏–µ, –æ–ø–∏—Å–∞–Ω–∏–µ, —Å—É–º–º—ã, –¥–∞—Ç—ã)

#### –ò–Ω–¥–µ–∫—Å—ã PostgreSQL
- `idx_users_username` - –ø–æ –ª–æ–≥–∏–Ω—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `idx_plans_user_id` - –ø–æ ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –ø–ª–∞–Ω–∞—Ö
- `idx_plans_dates` - –ø–æ –¥–∞—Ç–∞–º –ø–ª–∞–Ω–æ–≤

### MongoDB (–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏)
- **transactions** - –∫–æ–ª–ª–µ–∫—Ü–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π (—Ç–∏–ø, —Å—É–º–º–∞, –∫–∞—Ç–µ–≥–æ—Ä–∏—è, –æ–ø–∏—Å–∞–Ω–∏–µ, –ø–ª–∞–Ω)

#### –ò–Ω–¥–µ–∫—Å—ã MongoDB
- `plan_id_1` - –ø–æ ID –ø–ª–∞–Ω–∞
- `user_id_1` - –ø–æ ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `type_1` - –ø–æ —Ç–∏–ø—É —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ (income/expense)
- `category_1` - –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
- `created_at_1` - –ø–æ –¥–∞—Ç–µ —Å–æ–∑–¥–∞–Ω–∏—è
- `amount_1` - –ø–æ —Å—É–º–º–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

```bash
# –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –ø—Ä–æ–µ–∫—Ç–∞
cd lab4

# –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Ñ–∞–π–ª –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
cp env.example .env

# (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
nano .env
```

### 2. –ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ Docker Compose

```bash
# –°–±–æ—Ä–∫–∞ –∏ –∑–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ (PostgreSQL + MongoDB + —Å–µ—Ä–≤–∏—Å—ã)
make up
# –∏–ª–∏
docker-compose up --build

# –ó–∞–ø—É—Å–∫ –≤ —Ñ–æ–Ω–æ–≤–æ–º —Ä–µ–∂–∏–º–µ
docker-compose up --build -d
```

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–ø—É—Å–∫–∞

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è —Å–µ—Ä–≤–∏—Å–æ–≤
curl http://localhost:8000/health
curl http://localhost:8081/health

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î
make test-db

# –ü—Ä–æ–≤–µ—Ä–∫–∞ MongoDB —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏
python test_mongodb_example.py

# –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—É
make test-smoke
```

## –ü–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –∑–∞–ø—É—Å–∫—É

### –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
- Docker –∏ Docker Compose
- Python 3.11+ (–¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞)
- curl –∏–ª–∏ Postman (–¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è API)
- jq (–¥–ª—è –∫—Ä–∞—Å–∏–≤–æ–≥–æ –≤—ã–≤–æ–¥–∞ JSON, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

### –®–∞–≥ 1: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞–ª–∏—á–∏–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
docker --version
docker-compose --version

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –æ–∫—Ä—É–∂–µ–Ω–∏—è
make env-check
```

### –®–∞–≥ 2: –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –±–∞–∑ –¥–∞–Ω–Ω—ã—Ö

```bash
# –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –ø—Ä–∏–º–µ—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
cp env.example .env

# –û—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ .env:
# SECRET_KEY - —Å–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á –¥–ª—è JWT
# DATABASE_URL - —Å—Ç—Ä–æ–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ PostgreSQL
# MONGODB_URL - —Å—Ç—Ä–æ–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ MongoDB
# POSTGRES_DB - –∏–º—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö PostgreSQL
# POSTGRES_USER - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å PostgreSQL
# POSTGRES_PASSWORD - –ø–∞—Ä–æ–ª—å PostgreSQL
# PLANNING_SERVICE_URL - URL –ø–ª–∞–Ω–∏—Ä—É—é—â–µ–≥–æ —Å–µ—Ä–≤–∏—Å–∞
# ACCESS_TOKEN_EXPIRE_MINUTES - –≤—Ä–µ–º—è –∂–∏–∑–Ω–∏ —Ç–æ–∫–µ–Ω–∞
```

### –®–∞–≥ 3: –°–±–æ—Ä–∫–∞ –∏ –∑–∞–ø—É—Å–∫

```bash
# –°–±–æ—Ä–∫–∞ Docker –æ–±—Ä–∞–∑–æ–≤
make build

# –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ (PostgreSQL, MongoDB, API Gateway, Planning Service)
make up

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
make logs

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–µ—Ä–≤–∏—Å–æ–≤
make down
```

### –®–∞–≥ 4: –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–∞–∑ –¥–∞–Ω–Ω—ã—Ö

```bash
# PostgreSQL –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ
# MongoDB –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç –∫–æ–ª–ª–µ–∫—Ü–∏–∏ –∏ –∏–Ω–¥–µ–∫—Å—ã –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –æ–±—Ä–∞—â–µ–Ω–∏–∏

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –ë–î
curl http://localhost:8081/db/health

# –ü–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–∏–µ –ë–î (–ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏)
make db-reset
```

### –®–∞–≥ 5: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —Å–µ—Ä–≤–∏—Å–æ–≤
curl -f http://localhost:8000/health || echo "API Gateway –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω"
curl -f http://localhost:8081/health || echo "Planning Service –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω"

# –ü—Ä–æ–≤–µ—Ä–∫–∞ MongoDB —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏
python test_mongodb_example.py
```

## –†–∞–±–æ—Ç–∞ —Å –±–∞–∑–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö

### –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ PostgreSQL

```bash
# –ß–µ—Ä–µ–∑ Docker Compose
docker-compose exec postgres psql -U budget_user -d budget_db

# –õ–æ–∫–∞–ª—å–Ω–æ (–µ—Å–ª–∏ PostgreSQL —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω)
psql -h localhost -p 5432 -U budget_user -d budget_db
```

### –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ MongoDB

```bash
# –ß–µ—Ä–µ–∑ Docker Compose
docker-compose exec mongodb mongo transactions_db

# –õ–æ–∫–∞–ª—å–Ω–æ (–µ—Å–ª–∏ MongoDB —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω)
mongo mongodb://localhost:27017/transactions_db
```

### –°–∫—Ä–∏–ø—Ç—ã –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏

#### PostgreSQL
–ü—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è:
- –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü —Å –∏–Ω–¥–µ–∫—Å–∞–º–∏
- –í—Å—Ç–∞–≤–∫–∞ —Ç–µ—Å—Ç–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (–≤–∫–ª—é—á–∞—è admin/secret)
- –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–∏–º–µ—Ä–æ–≤ –ø–ª–∞–Ω–æ–≤ –±—é–¥–∂–µ—Ç–∞

#### MongoDB
–ü—Ä–∏ –ø–µ—Ä–≤–æ–º –æ–±—Ä–∞—â–µ–Ω–∏–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—é—Ç—Å—è:
- –ö–æ–ª–ª–µ–∫—Ü–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
- –ò–Ω–¥–µ–∫—Å—ã –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∑–∞–ø—Ä–æ—Å–æ–≤
- –°—Ö–µ–º—ã –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö

### CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏

#### PostgreSQL (SQLAlchemy ORM):
- **Create**: –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ –ø–ª–∞–Ω–æ–≤ —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π
- **Read**: –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö —Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π –∏ –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π
- **Update**: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∑–∞–ø–∏—Å–µ–π
- **Delete**: –£–¥–∞–ª–µ–Ω–∏–µ –∑–∞–ø–∏—Å–µ–π —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

#### MongoDB (PyMongo):
- **Create**: –°–æ–∑–¥–∞–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π
- **Read**: –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏ –∏ –∞–≥—Ä–µ–≥–∞—Ü–∏–µ–π
- **Update**: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –ø–æ ID
- **Delete**: –£–¥–∞–ª–µ–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –≤–ª–∞–¥–µ–ª—å—Ü–∞

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
# –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤
make test

# –¢–æ–ª—å–∫–æ unit —Ç–µ—Å—Ç—ã
make test-unit

# –¢–æ–ª—å–∫–æ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
make test-integration

# –¢–µ—Å—Ç—ã –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
make test-db

# Smoke —Ç–µ—Å—Ç—ã (–±—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞)
make test-smoke

# API —Ç–µ—Å—Ç—ã —á–µ—Ä–µ–∑ curl
make test-api

# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ MongoDB —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏
python test_mongodb_example.py
```

### –†—É—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API

#### 1. –ü–æ–ª—É—á–µ–Ω–∏–µ JWT —Ç–æ–∫–µ–Ω–∞

```bash
# –ó–∞–ø—Ä–æ—Å —Ç–æ–∫–µ–Ω–∞ –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
curl -X POST "http://localhost:8000/auth/login" \
  -H "Content-Type: application/json" \
  -d '{
    "username": "admin",
    "password": "secret"
  }'

# –û—Ç–≤–µ—Ç:
# {
#   "access_token": "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9...",
#   "token_type": "bearer"
# }
```

#### 2. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞ –¥–ª—è –∑–∞–ø—Ä–æ—Å–æ–≤

```bash
# –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ —Ç–æ–∫–µ–Ω –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é (–∑–∞–º–µ–Ω–∏—Ç–µ YOUR_TOKEN)
TOKEN="eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9..."

# –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
curl -H "Authorization: Bearer $TOKEN" \
  http://localhost:8000/auth/me

# –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–ª–∞–Ω–æ–≤ –±—é–¥–∂–µ—Ç–∞ –∏–∑ PostgreSQL
curl -H "Authorization: Bearer $TOKEN" \
  http://localhost:8000/api/plans

# –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –∏–∑ MongoDB
curl -H "Authorization: Bearer $TOKEN" \
  http://localhost:8000/api/transactions-mongo
```

#### 3. –°–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞–Ω–∞ –±—é–¥–∂–µ—Ç–∞ (PostgreSQL)

```bash
curl -X POST "http://localhost:8000/api/plans" \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "name": "–ú–µ—Å—è—á–Ω—ã–π –±—é–¥–∂–µ—Ç",
    "description": "–ü–ª–∞–Ω –¥–æ—Ö–æ–¥–æ–≤ –∏ —Ä–∞—Å—Ö–æ–¥–æ–≤ –Ω–∞ –º–µ—Å—è—Ü",
    "planned_income": 100000,
    "planned_expenses": 80000,
    "start_date": "2024-01-01",
    "end_date": "2024-01-31"
  }'
```

#### 4. –°–æ–∑–¥–∞–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –≤ PostgreSQL

```bash
curl -X POST "http://localhost:8000/api/transactions" \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "plan_id": 1,
    "type": "income",
    "amount": 50000,
    "description": "–ó–∞—Ä–ø–ª–∞—Ç–∞",
    "category": "salary"
  }'
```

#### 5. –°–æ–∑–¥–∞–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –≤ MongoDB

```bash
curl -X POST "http://localhost:8000/api/transactions-mongo" \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "plan_id": 1,
    "type": "expense",
    "amount": 1500,
    "description": "–ü–æ–∫—É–ø–∫–∞ –ø—Ä–æ–¥—É–∫—Ç–æ–≤",
    "category": "food",
    "user_id": "admin"
  }'
```

#### 6. –ü–æ–ª—É—á–µ–Ω–∏–µ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –ø–æ –ø–ª–∞–Ω—É (MongoDB)

```bash
curl -H "Authorization: Bearer $TOKEN" \
  http://localhost:8000/api/transactions-mongo/plan/1/analytics
```

### –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

#### Swagger UI
–û—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ:
- API Gateway: http://localhost:8000/docs
- Planning Service: http://localhost:8081/docs

#### –î–æ—Å—Ç—É–ø–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
- **–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä**: `admin` / `secret` (–ø–∞—Ä–æ–ª—å —Ö–µ—à–∏—Ä–æ–≤–∞–Ω –≤ PostgreSQL)

## API Endpoints

### API Gateway (http://localhost:8000)

| –ú–µ—Ç–æ–¥ | Endpoint | –û–ø–∏—Å–∞–Ω–∏–µ | –•—Ä–∞–Ω–∏–ª–∏—â–µ | –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è |
|-------|----------|----------|-----------|----------------|
| POST | `/auth/login` | –ü–æ–ª—É—á–µ–Ω–∏–µ JWT —Ç–æ–∫–µ–Ω–∞ | PostgreSQL | –ù–µ—Ç |
| POST | `/auth/register` | –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è | PostgreSQL | –ù–µ—Ç |
| GET | `/auth/me` | –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ | PostgreSQL | JWT |
| GET | `/api/plans` | –°–ø–∏—Å–æ–∫ –ø–ª–∞–Ω–æ–≤ –±—é–¥–∂–µ—Ç–∞ | PostgreSQL | JWT |
| POST | `/api/plans` | –°–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞–Ω–∞ | PostgreSQL | JWT |
| GET | `/api/plans/{id}` | –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–ª–∞–Ω–∞ –ø–æ ID | PostgreSQL | JWT |
| PUT | `/api/plans/{id}` | –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–ª–∞–Ω–∞ | PostgreSQL | JWT |
| DELETE | `/api/plans/{id}` | –£–¥–∞–ª–µ–Ω–∏–µ –ø–ª–∞–Ω–∞ | PostgreSQL | JWT |
| GET | `/api/transactions` | –°–ø–∏—Å–æ–∫ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π | PostgreSQL | JWT |
| POST | `/api/transactions` | –°–æ–∑–¥–∞–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ | PostgreSQL | JWT |
| GET | `/api/transactions/{id}` | –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ | PostgreSQL | JWT |
| PUT | `/api/transactions/{id}` | –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ | PostgreSQL | JWT |
| DELETE | `/api/transactions/{id}` | –£–¥–∞–ª–µ–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ | PostgreSQL | JWT |
| **GET** | **`/api/transactions-mongo`** | **–°–ø–∏—Å–æ–∫ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π** | **MongoDB** | **JWT** |
| **POST** | **`/api/transactions-mongo`** | **–°–æ–∑–¥–∞–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏** | **MongoDB** | **JWT** |
| **GET** | **`/api/transactions-mongo/{id}`** | **–ü–æ–ª—É—á–µ–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏** | **MongoDB** | **JWT** |
| **PUT** | **`/api/transactions-mongo/{id}`** | **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏** | **MongoDB** | **JWT** |
| **DELETE** | **`/api/transactions-mongo/{id}`** | **–£–¥–∞–ª–µ–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏** | **MongoDB** | **JWT** |
| **GET** | **`/api/transactions-mongo/plan/{id}/analytics`** | **–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –ø–æ –ø–ª–∞–Ω—É** | **MongoDB** | **JWT** |
| **GET** | **`/api/transactions-mongo/user/analytics`** | **–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è** | **MongoDB** | **JWT** |
| GET | `/health` | –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è | - | –ù–µ—Ç |

### Planning Service (http://localhost:8081)

| –ú–µ—Ç–æ–¥ | Endpoint | –û–ø–∏—Å–∞–Ω–∏–µ | –•—Ä–∞–Ω–∏–ª–∏—â–µ | –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è |
|-------|----------|----------|-----------|----------------|
| GET | `/plans` | –°–ø–∏—Å–æ–∫ –ø–ª–∞–Ω–æ–≤ | PostgreSQL | X-User Header |
| POST | `/plans` | –°–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞–Ω–∞ | PostgreSQL | X-User Header |
| GET | `/plans/{id}` | –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–ª–∞–Ω–∞ | PostgreSQL | X-User Header |
| PUT | `/plans/{id}` | –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–ª–∞–Ω–∞ | PostgreSQL | X-User Header |
| DELETE | `/plans/{id}` | –£–¥–∞–ª–µ–Ω–∏–µ –ø–ª–∞–Ω–∞ | PostgreSQL | X-User Header |
| GET | `/transactions` | –°–ø–∏—Å–æ–∫ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π | PostgreSQL | X-User Header |
| POST | `/transactions` | –°–æ–∑–¥–∞–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ | PostgreSQL | X-User Header |
| GET | `/transactions/{id}` | –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ | PostgreSQL | X-User Header |
| PUT | `/transactions/{id}` | –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ | PostgreSQL | X-User Header |
| DELETE | `/transactions/{id}` | –£–¥–∞–ª–µ–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ | PostgreSQL | X-User Header |
| **GET** | **`/transactions-mongo`** | **–°–ø–∏—Å–æ–∫ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π** | **MongoDB** | **X-User Header** |
| **POST** | **`/transactions-mongo`** | **–°–æ–∑–¥–∞–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏** | **MongoDB** | **X-User Header** |
| **GET** | **`/transactions-mongo/{id}`** | **–ü–æ–ª—É—á–µ–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏** | **MongoDB** | **X-User Header** |
| **PUT** | **`/transactions-mongo/{id}`** | **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏** | **MongoDB** | **X-User Header** |
| **DELETE** | **`/transactions-mongo/{id}`** | **–£–¥–∞–ª–µ–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏** | **MongoDB** | **X-User Header** |
| **GET** | **`/transactions-mongo/plan/{id}/analytics`** | **–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –ø–æ –ø–ª–∞–Ω—É** | **MongoDB** | **X-User Header** |
| **GET** | **`/transactions-mongo/user/analytics`** | **–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è** | **MongoDB** | **X-User Header** |
| GET | `/plans/{id}/analytics` | –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –ø–æ –ø–ª–∞–Ω—É | PostgreSQL | X-User Header |
| GET | `/health` | –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è | - | –ù–µ—Ç |
| GET | `/db/health` | –ü—Ä–æ–≤–µ—Ä–∫–∞ –ë–î | PostgreSQL + MongoDB | –ù–µ—Ç |

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
lab4/
‚îú‚îÄ‚îÄ README.md                    # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞
‚îú‚îÄ‚îÄ docker-compose.yml           # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Docker Compose (PostgreSQL + MongoDB)
‚îú‚îÄ‚îÄ Makefile                     # –ö–æ–º–∞–Ω–¥—ã –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–æ–º
‚îú‚îÄ‚îÄ env.example                  # –ü—Ä–∏–º–µ—Ä –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
‚îú‚îÄ‚îÄ .env                         # –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (—Å–æ–∑–¥–∞–µ—Ç—Å—è)
‚îú‚îÄ‚îÄ pytest.ini                  # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è pytest
‚îú‚îÄ‚îÄ test_mongodb_example.py      # –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ MongoDB —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏
‚îú‚îÄ‚îÄ init-db/                     # –°–∫—Ä–∏–ø—Ç—ã –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ PostgreSQL
‚îÇ   ‚îú‚îÄ‚îÄ 01-create-tables.sql     # –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü –∏ –∏–Ω–¥–µ–∫—Å–æ–≤
‚îÇ   ‚îî‚îÄ‚îÄ 02-insert-data.sql       # –í—Å—Ç–∞–≤–∫–∞ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
‚îú‚îÄ‚îÄ init-mongo/                  # –°–∫—Ä–∏–ø—Ç—ã –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ MongoDB
‚îÇ   ‚îî‚îÄ‚îÄ init-indexes.js          # –°–æ–∑–¥–∞–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–æ–≤ –≤ MongoDB
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ api-gateway/            # API Gateway —Å–µ—Ä–≤–∏—Å
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ api_gateway/        # –ò—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ models.py       # Pydantic –º–æ–¥–µ–ª–∏
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth.py         # JWT –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ main.py         # FastAPI –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Dockerfile          # Docker –æ–±—Ä–∞–∑
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ pyproject.toml      # Python –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ README.md           # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Å–µ—Ä–≤–∏—Å–∞
‚îÇ   ‚îî‚îÄ‚îÄ planning-service/       # Planning Service
‚îÇ       ‚îú‚îÄ‚îÄ planning_service/   # –ò—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ database/       # –ü–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î
‚îÇ       ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ postgres.py # PostgreSQL –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
‚îÇ       ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ mongodb.py  # MongoDB –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ models/         # –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö
‚îÇ       ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ postgres_models.py    # SQLAlchemy –º–æ–¥–µ–ª–∏
‚îÇ       ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ mongodb_models.py     # Pydantic –º–æ–¥–µ–ª–∏ –¥–ª—è MongoDB
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ services/       # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
‚îÇ       ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ plan_service.py       # –†–∞–±–æ—Ç–∞ —Å –ø–ª–∞–Ω–∞–º–∏ (PostgreSQL)
‚îÇ       ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ transaction_service.py # –†–∞–±–æ—Ç–∞ —Å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º–∏ (PostgreSQL)
‚îÇ       ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ transaction_mongo_service.py # –†–∞–±–æ—Ç–∞ —Å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º–∏ (MongoDB)
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ config.py       # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ main.py         # FastAPI –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
‚îÇ       ‚îú‚îÄ‚îÄ Dockerfile          # Docker –æ–±—Ä–∞–∑
‚îÇ       ‚îú‚îÄ‚îÄ pyproject.toml      # Python –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚îÇ       ‚îî‚îÄ‚îÄ README.md           # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Å–µ—Ä–≤–∏—Å–∞
‚îî‚îÄ‚îÄ tests/                      # –¢–µ—Å—Ç—ã
    ‚îú‚îÄ‚îÄ test_api_gateway.py     # –¢–µ—Å—Ç—ã API Gateway
    ‚îú‚îÄ‚îÄ test_planning_service.py # –¢–µ—Å—Ç—ã Planning Service
    ‚îú‚îÄ‚îÄ test_database.py        # –¢–µ—Å—Ç—ã PostgreSQL
    ‚îú‚îÄ‚îÄ test_mongodb.py         # –¢–µ—Å—Ç—ã MongoDB
    ‚îú‚îÄ‚îÄ test_integration.py     # –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
    ‚îî‚îÄ‚îÄ conftest.py             # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è pytest
```

## –ì–µ–Ω–µ—Ä–∞—Ü–∏—è OpenAPI —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–∏—Å—ã
make up

# –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ OpenAPI —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏
make save-openapi

# –§–∞–π–ª—ã –±—É–¥—É—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –∫–∞–∫:
# - openapi-api-gateway.json
# - openapi-planning-service.json
```

## –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

```bash
# –ü—Ä–æ—Å–º–æ—Ç—Ä –≤—Å–µ—Ö –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∫–æ–º–∞–Ω–¥
make help

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
make env-check

# –†–∞–±–æ—Ç–∞ —Å PostgreSQL
make db-connect      # –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ PostgreSQL
make db-status       # –°—Ç–∞—Ç—É—Å PostgreSQL
make db-reset        # –ü–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–∏–µ PostgreSQL

# –†–∞–±–æ—Ç–∞ —Å MongoDB
docker-compose exec mongodb mongo transactions_db  # –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ MongoDB

# –û—á–∏—Å—Ç–∫–∞ —Å–∏—Å—Ç–µ–º—ã
make clean

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–æ–≤
make down && make up

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞
docker-compose logs -f api-gateway
docker-compose logs -f planning-service
docker-compose logs -f postgres
docker-compose logs -f mongodb
```

## –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫

### –ü–æ—Ä—Ç—ã –∑–∞–Ω—è—Ç—ã
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –ø–æ—Ä—Ç—ã 8000, 8081, 5432 –∏ 27017 —Å–≤–æ–±–æ–¥–Ω—ã
lsof -i :8000
lsof -i :8081
lsof -i :5432
lsof -i :27017

# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—É—é—â–∏–µ –ø—Ä–æ—Ü–µ—Å—Å—ã –∏–ª–∏ –∏–∑–º–µ–Ω–∏—Ç–µ –ø–æ—Ä—Ç—ã –≤ docker-compose.yml
```

### –ü—Ä–æ–±–ª–µ–º—ã —Å Docker
```bash
# –ü–µ—Ä–µ—Å–æ–±–µ—Ä–∏—Ç–µ –æ–±—Ä–∞–∑—ã –±–µ–∑ –∫—ç—à–∞
docker-compose build --no-cache

# –û—á–∏—Å—Ç–∏—Ç–µ Docker —Å–∏—Å—Ç–µ–º—É
docker system prune -f
```

### –ü—Ä–æ–±–ª–µ–º—ã —Å PostgreSQL
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ PostgreSQL
docker-compose logs postgres

# –ü–µ—Ä–µ—Å–æ–∑–¥–∞–π—Ç–µ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
make db-reset

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç—Ä–æ–∫—É –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –≤ .env
echo $DATABASE_URL
```

### –ü—Ä–æ–±–ª–µ–º—ã —Å MongoDB
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ MongoDB
docker-compose logs mongodb

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
docker-compose exec mongodb mongo --eval "db.adminCommand('ismaster')"

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç—Ä–æ–∫—É –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è MongoDB –≤ .env
echo $MONGODB_URL
```

### –ü—Ä–æ–±–ª–µ–º—ã —Å —Ç–æ–∫–µ–Ω–∞–º–∏
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ SECRET_KEY –≤ .env
# –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ç–æ–∫–µ–Ω –Ω–µ –∏—Å—Ç–µ–∫ (default: 30 –º–∏–Ω—É—Ç)
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–æ—Ä–º–∞—Ç: "Bearer YOUR_TOKEN"
```

## –ö–æ–Ω—Ç–∞–∫—Ç—ã

**–°—Ç—É–¥–µ–Ω—Ç**: –ì—É–¥—ã–Ω–∏–Ω –î–∞–Ω–∏–ª–∞ –î–µ–Ω–∏—Å–æ–≤–∏—á  
**–ì—Ä—É–ø–ø–∞**: –ú8–û-109–°–í-24  
**–í–∞—Ä–∏–∞–Ω—Ç**: 12 (–ë—é–¥–∂–µ—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ)

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–æ–π —Ä–∞–±–æ—Ç–µ ‚Ññ4

1. ‚úÖ –î–ª—è —Å–µ—Ä–≤–∏—Å–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã–º–∏ —Å–æ–∑–¥–∞–Ω–æ –¥–æ–ª–≥–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –¥–∞–Ω–Ω—ã—Ö –≤ noSQL –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö MongoDB 4.0
2. ‚úÖ –í—ã–±—Ä–∞–Ω —Å–µ—Ä–≤–∏—Å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π (–Ω–µ —Å–≤—è–∑–∞–Ω–Ω—ã–π —Å –∫–ª–∏–µ–Ω—Ç—Å–∫–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏) –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ MongoDB, –∫–ª–∏–µ–Ω—Ç—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ –æ—Å—Ç–∞—é—Ç—Å—è –≤ PostgreSQL
3. ‚úÖ –°–æ–∑–¥–∞–Ω —Å–∫—Ä–∏–ø—Ç –ø–æ –Ω–∞–ø–æ–ª–Ω–µ–Ω–∏—é MongoDB —Ç–µ—Å—Ç–æ–≤—ã–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏, –∫–æ—Ç–æ—Ä—ã–π –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ —Å–µ—Ä–≤–∏—Å–∞
4. ‚úÖ –î–ª—è —Å—É—â–Ω–æ—Å—Ç–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π —Å–æ–∑–¥–∞–Ω—ã –∑–∞–ø—Ä–æ—Å—ã –∫ MongoDB (CRUD) —Å–æ–≥–ª–∞—Å–Ω–æ —Ä–∞–Ω–µ–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–Ω–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ
5. ‚úÖ –°–æ–∑–¥–∞–Ω—ã –∏–Ω–¥–µ–∫—Å—ã, —É—Å–∫–æ—Ä—è—é—â–∏–µ –∑–∞–ø—Ä–æ—Å—ã –≤ MongoDB
6. ‚úÖ –ü—Ä–∏–º–µ–Ω–µ–Ω–æ –∏–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ –ø–æ–ª—è–º –ø–æ–∏—Å–∫–∞ (plan_id, user_id, type, category, created_at, amount)
7. ‚è≥ –ê–∫—Ç—É–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ –º–æ–¥–µ–ª—å –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã –≤ Structurizr DSL
8. ‚úÖ –°–µ—Ä–≤–∏—Å—ã –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ docker-compose –∫–æ–º–∞–Ω–¥–æ–π docker-compose up

## –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ (—Å–æ–≥–ª–∞—Å–Ω–æ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è–º)

### –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ –¥–ª—è Python:
- **FastAPI** –¥–ª—è –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤ ‚úÖ
- **Pydantic** –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –º–æ–¥–µ–ª–µ–π ‚úÖ
- **PyMongo** –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –°–£–ë–î MongoDB ‚úÖ
- **SQLAlchemy** –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å PostgreSQL ‚úÖ
- **bcrypt** –¥–ª—è —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è –ø–∞—Ä–æ–ª–µ–π ‚úÖ
- **MongoDB 4.0** –∫–∞–∫ noSQL –°–£–ë–î ‚úÖ
- **PostgreSQL 14** –∫–∞–∫ —Ä–µ–ª—è—Ü–∏–æ–Ω–Ω–∞—è –°–£–ë–î ‚úÖ
- **Docker & Docker Compose** –¥–ª—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏–∏ ‚úÖ

### –ü—Ä–∏–º–µ—Ä —Å—Ç—Ä—É–∫—Ç—É—Ä—ã MongoDB –º–æ–¥–µ–ª–∏:
```python
from pydantic import BaseModel, Field
from datetime import datetime
from enum import Enum
from typing import Optional

class TransactionType(str, Enum):
    income = "income"
    expense = "expense"

class TransactionMongo(BaseModel):
    id: Optional[str] = Field(None, alias="_id")
    plan_id: int
    type: TransactionType
    amount: float
    description: str
    category: str
    user_id: str
    created_at: datetime = Field(default_factory=datetime.utcnow)
    
    class Config:
        populate_by_name = True
        json_encoders = {
            datetime: lambda v: v.isoformat()
        }

    def to_mongo(self):
        data = self.dict(by_alias=True, exclude_none=True)
        if "_id" in data and data["_id"] is None:
            del data["_id"]
        return data

    @classmethod
    def from_mongo(cls, data):
        if "_id" in data:
            data["_id"] = str(data["_id"])
        return cls(**data)
```

### –ü—Ä–∏–º–µ—Ä –∏–Ω–¥–µ–∫—Å–æ–≤ MongoDB:
```javascript
// –°–æ–∑–¥–∞–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–æ–≤ –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∑–∞–ø—Ä–æ—Å–æ–≤
db.transactions.createIndex({ "plan_id": 1 });
db.transactions.createIndex({ "user_id": 1 });
db.transactions.createIndex({ "type": 1 });
db.transactions.createIndex({ "category": 1 });
db.transactions.createIndex({ "created_at": 1 });
db.transactions.createIndex({ "amount": 1 });
db.transactions.createIndex({ "plan_id": 1, "user_id": 1 });
```

## –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### –†–µ–∑—É–ª—å—Ç–∞—Ç—ã pytest:
- ‚úÖ **66 —Ç–µ—Å—Ç–æ–≤ –ø—Ä–æ—à–ª–∏ —É—Å–ø–µ—à–Ω–æ**
- ‚è© **9 MongoDB —Ç–µ—Å—Ç–æ–≤ –ø—Ä–æ–ø—É—Å–∫–∞—é—Ç—Å—è** –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –≤ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ–π —Å—Ä–µ–¥–µ
- üìä **–£—Å–ø–µ—à–Ω–æ—Å—Ç—å: 88%** (66 –∏–∑ 75 —Ç–µ—Å—Ç–æ–≤)

### –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:
- ‚úÖ **PostgreSQL**: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –∏ –ø–ª–∞–Ω—ã –±—é–¥–∂–µ—Ç–∞
- ‚úÖ **MongoDB**: –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ —Å –ø–æ–ª–Ω—ã–º CRUD
- ‚úÖ **API Gateway**: JWT –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ
- ‚úÖ **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è**: –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ –º–µ–∂–¥—É —Å–µ—Ä–≤–∏—Å–∞–º–∏
- ‚úÖ **Docker Compose**: –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤

## –í–∞—Ä–∏–∞–Ω—Ç 12
–ë—é–¥–∂–µ—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å –≥–∏–±—Ä–∏–¥–Ω—ã–º —Ö—Ä–∞–Ω–µ–Ω–∏–µ–º:
- **PostgreSQL**: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏, –ø–ª–∞–Ω—ã –±—é–¥–∂–µ—Ç–∞
- **MongoDB**: –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞
- **API**: REST API –¥–ª—è –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
